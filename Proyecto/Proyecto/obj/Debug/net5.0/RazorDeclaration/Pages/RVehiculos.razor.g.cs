// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace Proyecto.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Proyecto;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Proyecto.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using System.Net.Http.Headers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using BlazorInputFile;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\_Imports.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\Pages\RVehiculos.razor"
           [Authorize]

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/RVehiculos")]
    public partial class RVehiculos : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 254 "D:\Tareas\5to Cuatrimestre\PROG 3\FINAL\Final\FinalProg3\Proyecto\Proyecto\Pages\RVehiculos.razor"
       
    /////////////////
    Funciones fc = new Funciones();
    List<Vehiculos> vehiculos;
    /// Variables:
    string NO = "NO";
    string YES = "YES";
    bool vofTabla = false;
    public string url = "NADA";
    string mensajeFoto = "";
    public double lat;
    public double lng;

    public string ID = "";
    public string Marca = "";
    public string Modelo = "";
    public int Year = 2020;
    public string Color = "";
    public string Precio = "";
    public string Tipo = "Carro";
    public string Carga = "";
    public string Pasajeros = "";
    public string Matricula = "";
    public string Seguro = "";

    bool vofFinish = false;

    string statu = "";
    int editar = 0;
    bool vofEdit = false;
    string imgURL = "";
    int cambio = 0;

    /// METODOS


    ///IMAGEN
    public async Task Cambio(IFileListEntry[] files)
    {
        await fc.CargarImagen(files);

        mensajeFoto = "Imagen Seleccionada: " + files.FirstOrDefault().Name;
        cambio = 1;
    }

    public async Task Obtener()
    {

        url = await fc.ObtenerURL();

    }
    /// MAPA
    /// 



    async ValueTask<double> _Latitud()
    {
        return await JS.InvokeAsync<double>("latitud", lat);
    }
    async ValueTask<double> _Longitud()
    {
        return await JS.InvokeAsync<double>("longitud", lng);
    }



    async Task abrirModal()
    {

        await JS.InvokeVoidAsync("open", null);
        await JS.InvokeVoidAsync("addMapa", null);

    }
    async Task cerrarModal()
    {
        lat = await _Latitud();
        lng = await _Longitud();
        await JS.InvokeVoidAsync("close", null);



    }



    ////
    /// ENVIAR DATOS

    public async Task EnviarDatos()
    {
        await Obtener();
        vofFinish = false;
        HttpClient http = new HttpClient();


        string URI = "https://finalprog3-930fc-default-rtdb.firebaseio.com/Vehiculos.json";

        var values = new Vehiculos { Carga = Carga, Color = Color, Estado = "YES", Foto = url, Marca = Marca, Matricula = Matricula, Modelo = Modelo, Tipo = Tipo, Year = Year.ToString(), Pasajeros = Pasajeros, Price = Precio, Seguro = Seguro, Lat = lat.ToString(), Lng = lng.ToString() };
        var json = JsonConvert.SerializeObject(values, Formatting.Indented);

        var vehiculo = new StringContent(json);

        var res = await http.PostAsync(URI, vehiculo);
        if (res.IsSuccessStatusCode)
        {
            vofFinish = true;
            Carga = "";
            Color = "";


            url = "";
            Marca = "";
            Matricula = "";
            Modelo = "";
            Tipo = "Carro";
            Year = 2020;
            Pasajeros = "0";
            Precio = "0";
            Seguro = "";
            lat = 0;
            lng = 0;
            mensajeFoto = "";

            await OnInitializedAsync();
        }
    }


    ///ACTIVAR o DESACTIVAR

    async Task ChangeStatus(string id, string status)
    {
        HttpClient http = new HttpClient();


        string URI = "https://finalprog3-930fc-default-rtdb.firebaseio.com/Vehiculos/";

        var values = new { Estado = status };
        var json = JsonConvert.SerializeObject(values, Formatting.Indented);

        var vehiculo = new StringContent(json);

        statu = "Paso 1";


        var response = await http.PatchAsync(URI + id + ".json", vehiculo);

        statu = "Paso 2";

        if (response.IsSuccessStatusCode)
        {
            await OnInitializedAsync();

        }

    }


    /// Editar

    void Edit(string id,
        string carga,
        string color,

        string foto,
        string latitud,
        string longitud,
        string marca,
        string matricula,
        string modelo,
        string pasajeros,
        string price,
        string seguro,
        string tipo,
        string year
        )
    {
        vofFinish = false;

        editar = 1;
        ID = id;
        Carga = carga;
        Color = color;
        url = foto;
        lat = Convert.ToDouble(latitud);
        lng = Convert.ToDouble(longitud);
        Marca = marca;
        Matricula = matricula;
        Modelo = modelo;
        Pasajeros = pasajeros;
        Precio = price;
        Seguro = seguro;
        Tipo = tipo;
        Year = Convert.ToInt32(year);

        imgURL = url;
        vofEdit = true;



    }


    async Task Update()
    {
        if(cambio != 0)
        {
            await Obtener();
        }

        HttpClient http = new HttpClient();


        string URI = $"https://finalprog3-930fc-default-rtdb.firebaseio.com/Vehiculos/{ID}.json";

        var values = new Vehiculos { Carga = Carga, Color = Color,  Foto = url, Marca = Marca, Matricula = Matricula, Modelo = Modelo, Tipo = Tipo, Year = Year.ToString(), Pasajeros = Pasajeros, Price = Precio, Seguro = Seguro, Lat = lat.ToString(), Lng = lng.ToString() };
        var json = JsonConvert.SerializeObject(values, Formatting.Indented);

        var vehiculo = new StringContent(json);

        var response = http.PatchAsync(URI, vehiculo);
        if (response.Result.IsSuccessStatusCode)
        {
            vofEdit = false;
            editar = 0;
            vofFinish = true;
            cambio = 0;
           
            Carga = "";
            Color = "";


            url = "";
            Marca = "";
            Matricula = "";
            Modelo = "";
            Tipo = "Carro";
            Year = 2020;
            Pasajeros = "0";
            Precio = "0";
            Seguro = "";
            lat = 0;
            lng = 0;
            mensajeFoto = "";

            await OnInitializedAsync();
        }
    }

    /// Guardar


    async Task Guardar()
    {
        if(editar == 0)
        {
            await EnviarDatos();
        }
        else
        {
            await Update();
        }
    }

    /// OBTENER DATOS



    protected override async Task OnInitializedAsync()
    {


        HttpClient http = new HttpClient();
        string URI = "https://finalprog3-930fc-default-rtdb.firebaseio.com/Vehiculos.json";

        var response = await http.GetAsync(URI);

        if (response.IsSuccessStatusCode)
        {
            var content = await response.Content.ReadAsStringAsync();

            var datos = JsonConvert.DeserializeObject<Dictionary<string, Vehiculos>>(content).ToList();

            var datos2 = from xd in datos
                         select new Vehiculos
                         {
                             ID = xd.Key,
                             Carga = xd.Value.Carga,
                             Color = xd.Value.Color,
                             Estado = xd.Value.Estado,
                             Foto = xd.Value.Foto,
                             Lat = xd.Value.Lat,
                             Lng = xd.Value.Lng,
                             Marca = xd.Value.Marca,
                             Matricula = xd.Value.Matricula,
                             Modelo = xd.Value.Modelo,
                             Pasajeros = xd.Value.Pasajeros,
                             Price = xd.Value.Price,
                             Seguro = xd.Value.Seguro,
                             Tipo = xd.Value.Tipo,
                             Year = xd.Value.Year

                         };

            vehiculos = datos2.ToList();
            vofTabla = true;


        }





    }



    /// 




    ///////////////////

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JS { get; set; }
    }
}
#pragma warning restore 1591
